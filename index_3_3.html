<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Midterm Data Visualization">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <script type"text/javascript" src="javascripts/d3.js"></script>
    <title>My Final Exam</title>
    <style>
       *{
          font-family:Garamond;
        }

        #myheader{
          height: 160px;
          min-width:930px;
          text-align:center;
          background-color: #F0F0F0 ;
          border:2px solid #E0E0E0;
          border-radius: 10px;
        }
        #myIndex{
          position:fixed;
          top:182px;
          text-align:right;
          background-color: white ;
          line-height: 100%;
          width: 240px;
          padding-right: 10px;
          float:left;
          border:2px solid #E0E0E0;
          border-radius: 10px;
        }
        #myBody{
          margin: 10px;
          top: 2000px;
          margin-left:250px;
        }
        #mainDiv{
          margin: 10px;
          text-align:center;
          background-color: #F8F8F8 ;
          border:2px solid #E0E0E0;
          border-radius: 10px;
          min-width:670px;
          max-width:1020px;
        }
    </style>
  </head>

  <body>
    <!--Header-->
    <div id="myheader">
      <h1>Data Visualization Final Exam</h1>
      <h2>Manuel Ramirez</h2>
      <h3>IE 590</h3>  
    </div>   
    <!--IndexLeft-->
    <div id="myIndex">
      <h1>Index</h1>
      <h3><a href="index.html">3.1. Static Spreadsheet</a></h3>
      <h3><a href="index_3_2.html">3.2. Spreadsheet with Typical Sorting</a></h3>
      <h3>3.3. Spreadsheet with SimulSort</h3>
    </div>
    <!--Body-->
    <div id="myBody">
      <!--Participants Header-->
      <div id="mainDiv">
        <!--3.1. Bar Chart-->
        <h2>3.1. Static Spreadsheet</h2>
        <script type="text/javascript">
          //Read datafile
          d3.json("https://hivelab.org/static/exam2.json",function(data){
            var padding=30;
            var w=600;
            var h=w*2/3;
            var width=(w-2*padding)/8;
            var height=22;
            //Create SVG
            svg=d3.select("#mainDiv")
                  .append("svg")
                  .attr("width",w)
                  .attr("height",h)
                  .style("background","ghostwhite"); 
            //Create header groups
            headersG=svg.selectAll(".header")
              .data(Object.keys(data[0]))
              .enter()
              .append("g")
              .attr("class",function(d){return d;})
              .on("click", function(){
                var myThis=d3.select(this)
                var criteria=myThis.attr("class")
                newData=data
                  .sort(function(a,b){return d3.ascending(a[criteria],b[criteria]);});
                //Erase previous column
                d3.selectAll(".item."+criteria).remove();
                //Daw new column
                newCol=svg.selectAll("#newColulumn")
                  .data(newData)
                  .enter()
                  .append("g")
                  .attr("class",function(d){return "item "+criteria+" "+d.ItemNo;})
                  .on("mouseover", function(){
                    d3.selectAll("rect#white")
                      .attr("fill","white");
                    d3.selectAll(".header")
                      .attr("fill","lightgrey");
                    d3.selectAll(function(d){return "."+d.ItemNo+"#white";})
                      .attr("fill","yellow");
                  })
                  .on("click", function(){
                    d3.selectAll("rect")                        
                      .attr("fill","white")
                      .attr("id", "white");
                    d3.selectAll(".header")
                      .attr("fill","lightgrey");
                    d3.selectAll(function(d){console.log(d.ItemNo);return "."+d.ItemNo;})
                      .attr("fill","lightgreen")
                      .attr("id", "green");
                  });
                //Add new rectangles
                newRect=newCol.append("rect")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("x", function(d){return padding+Object.keys(d).indexOf(criteria)*width;})
                    .attr("y", function(d,i){return padding+(1+i)*height;})
                    .attr("fill", "#F8F8F8")
                    .attr("stroke", "grey")
                    .attr("stroke-width", "1px")
                    .attr("class", function(d){return criteria+" "+d.ItemNo;});
                  //Add new text for each cell
                newText= newCol.append("text")
                  .attr("x", function(d){return -2+padding+(1+Object.keys(d).indexOf(criteria))*width;})
                  .attr("y", function(d,i){return padding+(2+i)*height-3;})
                  .attr("fill", "black")
                  .attr("style","font-size:20px")
                  .attr("text-anchor","end")
                  .text(function(d){return d[criteria];});
              })
            //Create headers cells/rectangles
            headersR= headersG.append("rect")
              .attr("width", width)
              .attr("height", height)
              .attr("x", function(d,i){return padding+i*width;})
              .attr("y", padding)
              .attr("fill", "lightgrey")
              .attr("stroke", "grey")
              .attr("stroke-width", "1px")
              .attr("class",function(d){return "header "+d;})
            //Add header titles
            headersT= headersG.append("text")
              .attr("x", function(d,i){return -2+padding+(1+i)*width;})
              .attr("y", padding+height-3)
              .attr("fill", "black")
              .attr("style","font-size:20px")
              .attr("text-anchor","end")
              .text(function(d){return d;});
            //Create chart body
            data.forEach(function(element, i){
              Object.keys(element).forEach(function(entity, j){
                  //Create a group for each cell
                  bodyC= svg.append("g")
                    .attr("class", function(){return "item "+Object.keys(element)[j]+" "+element.ItemNo;})
                    .on("mouseover", function(){
                      d3.selectAll("rect#white")
                        .attr("fill","white");
                      d3.selectAll(".header")
                        .attr("fill","lightgrey");
                      d3.selectAll("."+element.ItemNo+"#white")
                        .attr("fill","yellow");
                    })
                    .on("click", function(){
                      d3.selectAll("rect")
                        .attr("fill","white")
                        .attr("id", "white");
                      d3.selectAll(".header")
                        .attr("fill","lightgrey");
                      d3.selectAll("."+element.ItemNo)
                        .attr("fill","lightgreen")
                        .attr("id", "green");
                    });
                  //Create rectangle for each cell
                  bodyR= bodyC.append("rect")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("x", function(){return padding+j*width;})
                    .attr("y", padding+(1+i)*height)
                    .attr("fill", "#F8F8F8")
                    .attr("stroke", "grey")
                    .attr("stroke-width", "1px")
                    .attr("class", function(){return Object.keys(element)[j]+" "+element.ItemNo;});
                  //Create text for each cell
                  bodyT= bodyC.append("text")
                    .attr("x", function(){return -2+padding+(1+j)*width;})
                    .attr("y", padding+(2+i)*height-3)
                    .attr("fill", "black")
                    .attr("style","font-size:20px")
                    .attr("text-anchor","end")
                    .text(function(){return data[i][Object.keys(element)[j]];});
              });
            });
          });
        </script>
      </div>
    </div>  
  </body>
</html>
